%!TEX root = ../thesis.tex
%*******************************************************************************
%****************************** Third Chapter **********************************
%*******************************************************************************
\chapter{Optimising energy group structures for neutron activation calculations in fusion systems}
\label{chap:group_structure}

% **************************** Define Graphics Path **************************
\ifpdf
    \graphicspath{{Chapter3/Figs/Raster/}{Chapter3/Figs/PDF/}{Chapter3/Figs/}}
\else
    \graphicspath{{Chapter3/Figs/Vector/}{Chapter3/Figs/}}
\fi

% INTRODUCTION
%   Group structure optimisation literature review
%     Include a simple convergence study result
%   Self-shielding
%   Resonance behaviour: parameter correlations (matrix, resonance widths, f(Z,E))
%     Resonance Integrals, although structure, big resonances spread out over E-space
% METHOD
%   Nuclear data processing infrastructure
%     Pointwise ENDF
%     A Compact ENDF
%     Groupwise ENDF
%     Probability tables
%     Self-shielding factors
%   Energy group optimisation
%     Building a bin density distribution: rho(E) = SSF_{eff} + bpd_min
%     An iterative implementation
%   Radiation transport
%     Simple test case    #Â data on freia
%     JET model           
% RESULTS
%   Single optimisation: JET activation foils
%   Iterative optimisation: simple test case
% CONCLUSIONS / FURTHER WORK

\section{Outline}
\label{sec:outline}

This study utilises self-shielding factors as a means to optimise energy group structures for fusion activation calculations. Informed by an analysis of important fusion resonances and a survey of relevant incident particle spectra, we develop and test two new group structures designed to more accurately represent the physics of nuclear reactions. They are compared to group structures commonly used in fusion research \& analysis. When used in a JET activation foil scenario, the optimised group structures outperform reference group structures, such as CCFE-709, while requiring fewer bins.

\section{Introduction}

Nuclear simulations for fusion devices are essential to determine material damage, activation-transmutation and to perform dose rate analyses. While continuous energy Monte Carlo modeling can be used to directly calculate reaction rates, due to the very large number (potentially tens of thousands) of possible reaction channels, it is impractical to compute all nuclear reactions of interest by this so-called point-wise approach. A separate inventory code, such as FISPACT-II \cite{fispact2015}, utilising a discretised incident particle spectrum is typically used to calculate all of these reaction rates, solve for the time-dependent nuclide inventory and provide various responses and source terms. This multi-group method is computationally efficient, but introduces self-shielding errors.

\subsection{Group structure optimisation}
% Greatly expand this...
The likelihood of interaction between an incident particle and a nucleus is a a non-linear function of energy in the resonant energy region. The cross-section, $\sigma(\mathrm{E})$ and the associated reaction rate, RR(E), may vary by several orders of magnitude within a few electron-volts. The number of bins that the energy domain is discretised over has a strong influence on the accuracy of the result. While increasing the number of bins increases the accuracy it also increases the time required to converge an input spectrum and the memory required to record this information\footnote{A concern for simulations with millions of voxels, common in activation-dose calculations.}. 

\begin{figure}[H]
  \centering
  \includegraphics[width=0.8\linewidth]{gendf_convergence}
  \caption{This figure shows the results from a series of calculations with increasingly fine energy discretisations, or group structures. The bins for all groups are equally log-spaced. The calculation is to determine the (n,$\gamma$) reaction rate in a shell of \textsuperscript{186}W due to some incident neutron flux. The dependent variable is the \% change on a point-wise (true) value calculated with MCNP.}
  \label{fig:gendf_convergence}
\end{figure}

In addition to the number of bins, their bound locations have a strong relationship to the result accuracy. The integer bin count number and bound locations energy vector are together known as an energy group structure. This paper presents results from a novel method for optimising energy group structures given a selection of materials and a guessed spectrum.

There have been several previous efforts to optimise neutron energy group structures. Certain applications lend themselves to highly targeted group structures. For example, fission reactor lattice physics calculations are typically interested in determining a few reaction rates to very high accuracy. The Studsvik team who develop the CASMO-5 lattice physics code employ a neutron group structure with very fine resolution around the principal $^{238}\mathrm{U}$ and $^{240}\mathrm{Pu}$ resonances \cite{Rhodes2006}. Covering these areas with a fine energy grid results in a more accurate estimate of key reaction rates and hence calculation of the neutrons absorbed and consequently lost from the system. Particle Swarm Optimisation (PSO) has been used multiple times to improve bin bound placement for multi-group libraries used for reactor physics applications \cite{Yi2013} \cite{Akbari2012} \cite{Akbari2013} \cite{Fleming2016}. \citet{Morgan2013} have explored hyperfine multi-group (MG) data as an alternative to the interpolation of point-wise (PW) data as typically employed by particle transport codes such as MCNP6.1 \cite{goorley2012}. Some attention has been directed towards the refinement of reaction rate calculation for specific elements and nuclides in fusion scenarios. For instance, work on the spatial heterogeneity of tungsten transmutation has been undertaken by \citet{Gilbert2016} who used the CCFE 709 bin group structure and careful application of self-shielding factors to accurately determine reaction rates.

\subsection{Resonance distributions}

% In terms of targeting group structure resolution, what can we learn from the distribution of resonance locations and widths?

\begin{figure}[H]
  \centering
  \includegraphics[width=\linewidth]{nnprime_res_3d}
  \caption{}
  \label{fig:}
\end{figure}

% Need to introduce the concept of a resonance integral, refer back to BW description and describe our integration
% Explain the correlations in the cor matrix

\begin{figure}[H]
  \centering
  \includegraphics[width=\linewidth]{res_correlation}
  \caption{}
  \label{fig:}
\end{figure}

% So if we can determine which resonances are `biggest', how they are those ones inparticular distributed?
% Which features are there? 
% What causes them?
% Is any of this information useful to us?

\begin{figure}[H]
  \centering
  \includegraphics[width=\linewidth]{largest_res_width_scatter}
  \caption{}
  \label{fig:}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=\linewidth]{largest_res_energy_scatter}
  \caption{}
  \label{fig:}
\end{figure}

\subsection{Self-shielding}
% Describe phenomenon, giving examples as to where it's important, M. Gilbert, thermal fission plant, etc.
% Curse, as in something to be minimised, but also an opportunity as a vector for attacking the problem

As indicated above, a resonant material of particular interest to fusion plant designers is tungsten, with $^{186}\mathrm{W}(n,\gamma)$ shown in figure \ref{fig:w_cross_section}. This figure highlights the difficulties of determining reaction rates to a high accuracy. $^{186}$W has a large resonance at 18 eV and the energy-integrated reaction rate within this resonance typically dominates the total reaction rate. With the coarse group structure shown in the figure, an unshielded approach to computing the reaction rate yields values several times the `true' point-wise value.

The self-shielding of resonant materials other than tungsten has yet to receive much attention in nuclear analyses of fusion power systems. A robust approach for accurately determining reaction rates for any material composition would be a welcome tool for future analyses. The rest of this paper details the first results of one approach, namely the intelligent discretisation of spectra and nuclear data, applied to an activation foil problem.

% Need a simple self-shielding figure here

%\subsection{JET}

\section{Method}
\label{S:2}
The radiation transport geometry utilised in this study is the JET tokamak located near Abingdon, Oxfordshire. Octant 8 of the tokamak has previously housed the Long Term Irradiation Station (LTIS) for exposing activation foils to the JET neutron field. A variety of $(n,\gamma)$ effective cross-sections have been calculated in various materials and for a selection of energy group structures. Some of these group structures are optimised for the materials present in the simulation, while others are standard group structures in common usage today. 

The calculation of effective cross-sections were carried out using three different techniques:
\begin{enumerate}
\item Multi-group FISPACT-II unshielded collapse
\item Multi-group FISPACT-II shielded collapse
\item Point-wise MCNP6 Monte Carlo Estimator (MCE)
\end{enumerate}

Methods 1 \& 2 discretise the incident spectrum, over a  $\phi(E)$ and $\sigma(E)$, taking the inner product of two vectors of constants,
$$\vec{\phi} \cdot \vec{\sigma} = \sum_i \phi(E_i , E_{i+1}) \sigma(E_i , E_{i+1}),$$
as the spectrum-averaged, effective cross section. However, for each group interval, $(E_{i}, E_{i+1}]$ the true functions $\phi(E),\ \sigma(E)$ are not contant. Regions with resonances in the cross section cause local decreases in the neutron flux, resulting in significant `self-shielding' errors with the multi-group method. To address this, self-shielding factors, $\mathrm{SSF}(E_i)$, may be used to account for these resonance effects. 

An incident spectrum, material inventory and nuclear data are input to FISPACT-II. The spectrum and interaction nuclear data are then collapsed to generate one-group effective cross-sections. With the addition of probability table data generated with CALENDF-2010 \cite{sublet2011}, $\mathrm{SSF}(E_i)$ are calculated for both the resolved and unresolved resonance regions.

Method 3 employs nuclear cross-section data with tens of thousands of points per reaction channel, interpolating between them to approximate a continuous energy treatment. The effective radiative capture cross-section can be determined from the point-wise calculated $(n,\gamma)$ reaction rate as equation \ref{eq:pw}. 

\begin{equation}
\label{eq:pw}
\sigma_\mathrm{eff} = \frac{\int RR_{n,\gamma}(E) dE}{\int \phi(E) dE}
\end{equation}

\subsection{Reactions}

The effective cross-sections calculated for this study were a series of radiative capture reactions in metals. These reactions often have a large fraction of their total reaction rate within the neutron slowing down region between thermal and fast energies. Hence, an accurate resonance treatment is required for accurate results. 

\begin{table}[h]
  \centering
  \begin{tabular}{lll}
    \toprule
    Reaction                                       & E$_\mathrm{first\ res.}$ (eV) & E$_\mathrm{URR}$ (eV) \\ 
    \midrule
    %%$^{58}\mathrm{Fe}(n,\gamma)^{59}\mathrm{Fe}$   & 2.29E2                        & 3.50E5                 \\
    %%$^{59}\mathrm{Co}(n,\gamma)^{60}\mathrm{Co}$   & 1.31E2                        & 1.19E5                \\
    $^{95}\mathrm{Mo}(n,\gamma)^{96}\mathrm{Mo}$   & 4.47E1                        & 5.87E4                \\
    $^{181}\mathrm{Ta}(n,\gamma)^{182}\mathrm{Ta}$ & 4.27E0                        & 4.00E3                \\
    $^{182}\mathrm{W}(n,\gamma)^{183}\mathrm{W}$   & 4.16E0                        & 9.91E4                \\
    $^{186}\mathrm{W}(n,\gamma)^{187}\mathrm{W}$   & 1.88E1                        & 1.21E5                \\ 
    \bottomrule
  \end{tabular}
  \caption{Shown above are the reactions simulated in this study. E$_\mathrm{first\ res.}$ indicates the energy of the first resonant peak in the interaction cross-section. E$_\mathrm{URR}$ defines the end of the resolved resonance range (RRR) and the start of the unresolved resonance range (URR) where experimental energy resolution is insufficient to resolve individual resonances.}
  \label{tab:reactions}
\end{table}

The reaction channels chosen for study are listed in table \ref{tab:reactions}. The nuclides listed are found in the designs of fusion power systems; iron is the principal constituent of all steels, cobalt a steel impurity which dominates shut down dose rates at intermediate time scales, molybdenum an important steel alloying element, tantalum is being investigated for use in high-heat flux componentry and tungsten is a current first choice for a plasma facing high-heat flux material.

\subsection{Group structure optimisation}
\label{sec:opt}

This study tests various group structures against a point-wise reference. We have generated two of the test group structures, attempting to optimise them to accurately calculate reaction rates for a set of nuclides.

To assemble a distribution for bin density we define several piecewise functions for identifying where, in the energy domain, self-shielding factor modifications are important and to indicate where resolution should be concentrated. 

Equation \ref{eq:s} describes the cumulative differences between reaction rates for some energy group, ${E = (E_{0}, E_{1}, \dots, E_{N}})$. 

\begin{equation}
\label{eq:s}
S(E_{g}) = \sum_{i=0}^{g} \mathrm{RR}(E_{i}) - \mathrm{RR}(E_{i})\mathrm{SSF}(E_{i})
\end{equation}

The cumulative, effective self-shielding distribution,

\begin{equation}
\label{eq:c}
C(E_{g}) = 1 - \left( \left(1-\overline{\mathrm{SSF}}\right) \frac{S(E_{g})} {S(E_{N})}\right)
\end{equation}

begins at 1 for the first energy group, and to reduce to a minimum of the effective self-shielding factor $\overline{\mathrm{SSF}}$,

\begin{equation}
\label{eq:ssf_bar}
\overline{\mathrm{SSF}} = \frac{\sum_{g=0}^{N}\mathrm{RR}(E_{g})\mathrm{SSF}(E_{g})}
{\sum_{g=0}^{N}\mathrm{RR}(E_{g})}.
\end{equation}

This function, $C(E)$, gives a dimensionless measure of the importance of self-shielding modifications to interaction data. It allows comparison between nuclides of different cross-section values, as it is scaled between unity and the nuclide's $\overline{\mathrm{SSF}}$. Discontinuities in C(E) show regions with large effective self-shielding. An example of a cumulative SSF distribution is shown in figure \ref{fig:w_cross_section}. 

The differences between discrete elements of the cumulative distribution provide an effective self-shielding distribution,

\begin{equation}
\label{eq:d}
D(E_{g}) = C(E_{g}) - C(E_{g-1}),
\end{equation}

that identifies the relative contributions from each bin to the overall self-shielding effect. It is shown as the effective self-shielding distribution in figure \ref{fig:w_cross_section}.

As such, $D(E)$ indicates where the the group structure requires enhanced resolution in an improved group structure. However, outside the resonance ranges, for example for E $< 10^{-2}$ or E $> 10^{5}$ eV, this distribution is identically zero. To enforce a minimum bin density, a constant, $b$, is added to all bins of $D(E)$ in the algorithm employed. 

\begin{equation}
\label{eq:b}
b = \frac{D(E) \Delta E(E)}{\frac{n_{bins}}{bpd_{min}} - d}
\end{equation}

The minimum bins per decade, $\mathrm{bpd}_{min}$ must be specified. Where $d$ is the number of decades described by the group structure, $n_{bins}$ is the total number of bins required of the new group structure and $\Delta E(E)$ is an array of the input group bin widths.

\begin{equation}
\label{eq:offset}
\rho(E) = D(E) + b
\end{equation}

$\rho(E)$ is an array of proposed local bin densities, on the input group structure. This is then rebinned into equal areas as per equation \ref{eq:equal} to determine the new, optimised group structure.

\begin{equation}
\label{eq:equal}
\int_{g=i-1}^{g=i} \rho(E_{g})dE = \frac{1}{n_\mathrm{bins}}\int_{g=0}^{g=N}\rho(E_{g})dE \end{equation} 

The group structures tested in this study are listed in table \ref{tab:groups}. The two groups, 280 and 650, generated by our process were optimised for all stable nuclides of the following elements: Fe, W, Mo, Nd, Sn, Zr, Cu, Co and Ta. This means we performed the nuclide-wise integral of $\rho(E)$ for all naturally occurring isotopes of these elements. 

\begin{table}[H]
  \centering
  \begin{tabular}{lllll}
    \toprule
    n$_\mathrm{bins}$ & E$_\mathrm{min}$ (eV) & E$_\mathrm{max}$ (eV) & bpd$_\mathrm{res}$ & Description \\ 
    \midrule
    709 & 1E-5 & 1E9 & 50 & CCFE \\
    650 & 1E-5 & 1E8 & 37--101 & Optimised fine \\
    315 & 1E-5 & 1.94E7 & 24--50 & TRIPOLI  \\
    280 & 1E-5 & 1E8 & 11--73 & Optimised coarse \\ 
    175 & 1E-5 & 1.96E7 & 5--22 & VITAMIN-J \\
    \bottomrule
  \end{tabular}
  \caption{Comparison of group structures tested, noting their bin counts, n$_\mathrm{bins}$, the energy range over which they are defined and the bins per decade, bpd$_\mathrm{res}$ they employ in the resonant region.}
  \label{tab:groups}
\end{table}

\subsection{Radiation transport}

In order to compare the performance of the different group structures, incident particle spectra were obtained. As previously mentioned, the LTIS foil holder is located within Octant 8 of the JET facility. The LTIS MCNP model \cite{lengar2017} was integrated into a reference JET model. The LTIS was populated with foils of the materials noted in table \ref{tab:reactions}. The simulation was set to tally the reaction rates of interest in each of the foils in each specified group structure. Point-wise tallies were also included.

\section{Results \& Discussion}
\label{sec:results}
% Introduce general approach again, tall plot of SSF effect functions is to follow

%%To generate self-shielding factors using FISPACT we require a spectrum. The spectrum shape guess was $\phi(E) = E^{0.192}$, or slightly harder than `flat' (see figure \ref{fig:spectrum} for an indication of the spectrum). 
% Include this test spectrum plot, and the lin-log profile used to bias the SSFs

\begin{figure}[H]
  \centering
  \includegraphics[width=0.8\linewidth]{W186_gamma}
  \caption{Shown in the upper plot is a $^{186}$W radiative capture reaction rate, both unshielded and shielded. The incident particle spectrum in this case is a power function of energy, i.e. $\phi(E) = E^{x}$ where $x$ is some constant. The second plot shows the calculated self-shielding factors as a function of energy for this reaction, given an elemental material composition. The third and fourth plots are derived quantities used for group structure optimisation.}
  \label{fig:w_cross_section}
\end{figure}

A set of sample LTIS spectra are as shown in figure \ref{fig:spectrum}. These particular spectra are from within the tungsten foil. Resonances both within the tungsten and the surrounding materials have resulted in flux depressions. An expanded view of the $^{186}$W 18 eV resonance is shown as figure \ref{fig:spectrum_detail}. The degree to which the resonances are resolved by the different group structures is a function of the bin resolution around the resonance. The 709 group, with a standard 50 bins per decade reaches down into the 18 eV resonance, recording a fluence of 3.5E-9 whilst the optimised group structures, 280 and 650 record 2.32E-9 and 1.26E-9. The standard group structures 175 and 315 which are much coarser in this region record a minimum fluence more than an order of magnitude greater than the 650 group structure.

\begin{figure}[H]
  \centering
  \includegraphics[width=\linewidth]{W186_spectra_diff_groups.eps}
  \caption{Typical DT neutron spectrum within the LTIS activation foil holder. The fluence of each bin has been divided by the lethargy width for that bin, $\Delta U$. The spectrum is hard, with little thermalisation as a consequence the foil's proximity to the plasma. The same neutrons have been binned according to various group structures, from 175 to 709 groups.}
  \label{fig:spectrum}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=\linewidth]{w_spectrum_detail}
  \caption{Magnified section of spectrum showing how progressively finer group structures resolve flux depressions in a neutron spectrum.}
  \label{fig:spectrum_detail}
\end{figure}

Figure \ref{fig:tungsten-182} shows a comparison of collapsed cross-sections for $^{182}$W. The abscissa lists each group structure tested. A pair of data points exist for each group structure, one with the use of self-shielding factors (shielded) and one without (unshielded). The abscissa order is a sorted such that the unshielded values decrease from left to right. The left ordinate indicates the absolute cross-section value in barns, while the right ordinate gives the cross-section as a percentage change over the point-wise (reference) value, i.e. +100\% means the multi-group calculation has over-estimated the cross-section and therefore reaction rate by a factor of 2.

As would be expected, in a simple, unshielded case having more groups and therefore a larger number of groups per energy decade tends to give multi-group results closer to the reference point-wise result. Flux depressions are better resolved with narrower groups and therefore the reaction rate resulting from resonances is not overestimated to the same degree. However, with the exception of $^{181}$Ta, the 650 optimised group, and even the 280 optimised group perform better than the 709 group in the unshielded regime. Their narrow groups are targeted where most useful, around the resonances which were poorly described by a equal logarithmically spaced group structure.

\begin{figure}[H]
  \centering
  \includegraphics[width=\linewidth]{W-182.eps}
  \caption{Comparison of different calculation methods for radiative capture in $^{182}$W under JET neutron irradiation.}
  \label{fig:tungsten-182}
\end{figure}

With regards to individual groups, the 175 group used unshielded performs very poorly, overestimating the reaction rate by at least a factor of 3 in all cases. The 650 optimised group is always within 50\% of the point-wise result and is the best performing group.

\begin{figure}[H]
  \centering
  \includegraphics[width=\linewidth]{W-186.eps}
  \caption{Comparison of different calculation methods for radiative capture in $^{186}$W under JET neutron irradiation.}
  \label{fig:tungsten-186}
\end{figure}

As might be expected the shielded results show far less variation between groups. 280, 315, 650 \& 709 demonstrate largely similar behaviour when used in conjunction with self-shielding factors. 175 does again over-estimate, between 0\% and 120\% depending on the nuclide.

\begin{figure}[H]
  \centering
  \includegraphics[width=\linewidth]{Ta-181.eps}
  \caption{Comparison of different calculation methods for radiative capture in $^{181}$Ta under JET neutron irradiation.}
  \label{fig:tantalum-181}
\end{figure}

The $^{181}$Ta (figure \ref{fig:tantalum-181}) and $^{95}$Mo (figure \ref{fig:molybdenum-95}) results indicate over-shielding, that is self-shielding factors over compensating for a poor description of the spectrum. This is particularly pronounced for the 315 group in $^{95}$Mo, where the shielded result is 40\% less than the point-wise result. This is due to the application of one set of self-shielding factors over the entirety of the foil depth. Although only 500 microns, the compound geometric effects are essential and are the subject of further work.

\begin{figure}[H]
  \centering
  \includegraphics[width=\linewidth]{Mo-95.eps}
  \caption{Comparison of different calculation methods for radiative capture in $^{95}$Mo under JET neutron irradiation.}
  \label{fig:molybdenum-95}
\end{figure}

\section{Conclusions}

This study has investigated how an incident spectrum and nuclear data library are discretised in energy (i.e. the group structure) effects the accuracy of reaction rate calculations. The selection of group structures trialled included three in current use and two which were optimised by our own, novel method.

The accuracy of multi-group reaction rate calculations is severely hampered by using the legacy VITAMIN-J 175 group structure. In the context of this activation foil problem, coarse group structures can give reasonable results if used in conjunction with modifying self-shielding factors. If used, self-shielding factors must be applied carefully, with potential geometric shielding effects considered. If used inappropriately, over-shielding may result, which may not be conservative depending on the context.

An optimisation algorithm has been demonstrated. The algorithm can generate and optimised set of bin bounds, given a `guess' spectrum and a target nuclide set. An unshielded multi-group calculation using an optimised group structure with 280 bins has more closely approximated the point-wise result than the 709 unshielded multi-group calculation in the majority of cases examined.

Further work will improve on the optimisation algorithm and explore the performance of optimised group structures in a wider array of circumstances. Iterative application of the algorithm will be investigated as well as geometric self-shielding effects. 

